# c3ps3tool

first rough brain-dump that will become a howto... special thanks to Samyaza @ C3 forums for helping test and develop this doc!

yes! it exists, it works (for me) and I use it often, but it comes with a bunch of caveats...
 
- tested on linux only... and it has dependencies on several other tools. i tried to make it path-agnostic, but i don't know how great it'll run from a windows machine. initial testing from one beta tester suggests that it doesn't work at all on windows (using Strawberry Perl), but they had more luck with linux.

- RBHP upgrades require a PS3_DTA_LIST.csv file generated by letting the c3 tools crawl your ps3 to generate a list of songs+paths you'll find that in the bin folder of the c3 tools after doing one of these crawls (i'm foggy on the details for generating it...)

- it worked for me, but might not work for you. i did a TON of testing before i let it loose on my PS3. in the end, i ended up using it to automatically apply all RBHP updates, and haven't found an issue yet. i started doing incremental updates with it almost 3 years ago, and i believe it was 2 years ago that i did my first mass update of all RBHP that existed at that time, and a final round a year or so back once the project was "done".

- it tries to be very cautious as it works, and makes backups of any existing file it modifies. the first time around it should create a .orig of your .dta files, intending to preserve a "golden master" if you ever need to get back. after that any updates will generate a foo.dta.timestamp version, so you can get back to a previous version... handy when something goes wrong.
 
- it also has several other features, some better tested than others. i actually use it to install all my customs these days. it relies on things being in the .rar format, but it's pretty smart. probably good to have other beta testers, i just keep not getting back around to updating that thread. eventually i hope to remove windows entirely from my customs installation and get it converting CON files to PS3, but it's not there yet...
 
c3ps3tool.pl is the only file you strictly need. edit the first chunk of it to make path updates where needed. if you run into issues, add the --log outputfile option to have it do some more verbose logging to a separate file and I can try to help you sort out what went wrong.
 
if you're doing RBHP upgrades, the tool needs to know where to find that csv, so make sure you include the "--dtalist /path/to/PS3_DTA_LIST.csv" option. that's required for any RBHP upgrade, even just a single song.
 
next, there's two ways to run RBHP upgrades: "--upgrade /path/to/rbhp/upgrade/to/apply" to do a single (or multiple) songs, or "--search /path/to/rbhp/dir" to search and upgrade everything you have installed (in the csv). looks like you're doing the latter - which is fine, just making you aware that it's the bigger option and if you want to try a simpler single song upgrade, that should also work.
 
the other vital piece of harmonies upgrades is that all the midi files need to be encrypted. two ways to accomplish that: 1) pull them all out of the RBHP tree, run them all through C3 tool to encrypt for ps3, then dump them in a dir and use the "--mididir /path/to/encrypted/midis/" to find them all. alternately, 2) you can download and install the make_npdata tool, build it, update the $npdataPath option to point to the file, and it'll automatically encrypt them all as it goes. I did option #1 my first couple of incremental updates as i hadn't yet found make_npdata, then make_npdata for my final mass update. https://github.com/aniruddh22/make_npdata
 
at a minimum, i think you need to install Net::FTP::Recursive , Text::CSV::Hashify, and String::ShellQuote for it to work. they may come with your ubuntu install, or you may have to use CPAN. i tried to stick to core modules, so the rest should already be included with your perl distribution. run this command to install the three of them:

sudo cpan -i Net::FTP::Recursive Text::CSV::Hashify String::ShellQuote
 
originally the ps3.config file was the same as the one c3 tools uses. it is used to populate a songid if it finds one that is non-numeric, and an authorid if one isn't present. i don't think it's really needed anymore as c3 does these things pretty well now. for reference, mine looks like:

SongIDPrefix=1
AuthorID=1408
CurrentSongNumber=357

by default it will quit rather than forcing reinstall/reupgrade. add the --reinstall option to force it to do it again and overwrite the old upgrade/install. 

